# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

{{- if eq .chezmoi.os "darwin" }}

# Homebrew (Apple Silicon)
eval "$(/opt/homebrew/bin/brew shellenv 2>/dev/null)" || eval "$(/usr/local/bin/brew shellenv 2>/dev/null)"
{{- end }}

# Path to your oh-my-zsh installation.
export ZSH="$HOME/.oh-my-zsh"

ZSH_THEME="robbyrussell"
#ZSH_THEME="powerlevel10k/powerlevel10k"

zstyle ':omz:update' mode auto

plugins=(git sudo kubectl history emoji encode64 web-search copypath copyfile copybuffer dirhistory jsontools zsh-syntax-highlighting zsh-autosuggestions zsh-completions)

source $ZSH/oh-my-zsh.sh

# aliases
alias vi='nvim'
alias vim='nvim'
alias cc-proxy='source cc-proxy'

{{- if eq .chezmoi.os "darwin" }}
# macOS color aliases (BSD ls uses -G)
alias ls='ls -G'
alias ll='ls -lG'
alias grep='grep --color=auto'
{{- else }}
alias ll='ls -ll --color=auto'
alias ls='ls --color=auto'
alias grep='grep --color=auto'
alias diff='diff --color=auto'
{{- if eq .chezmoi.os "linux" }}
alias ip='ip -color=auto'
{{- end }}
{{- end }}

autoload -U compinit && compinit

# rust
export PATH=$PATH:$HOME/.cargo/bin

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

{{- if ne .chezmoi.os "darwin" }}

# goproxy（macOS 除外）
export GOPROXY=https://proxy.golang.com.cn,direct
{{- end }}

# ruby
export PATH=$PATH:$HOME/.rbenv/bin

# local bin
export PATH=$PATH:$HOME/.local/bin

# nvm
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"

# rvm
export PATH="$PATH:$HOME/.rvm/bin"

# >>> conda initialize >>>
__conda_setup="$('$HOME/miniconda3/bin/conda' 'shell.zsh' 'hook' 2> /dev/null)"
if [ $? -eq 0 ]; then
    eval "$__conda_setup"
else
    if [ -f "$HOME/miniconda3/etc/profile.d/conda.sh" ]; then
        . "$HOME/miniconda3/etc/profile.d/conda.sh"
    else
        export PATH="$HOME/miniconda3/bin:$PATH"
    fi
fi
unset __conda_setup
# <<< conda initialize <<<

# >>> xmake >>>
[[ -s "$HOME/.xmake/profile" ]] && source "$HOME/.xmake/profile"
# <<< xmake <<<

{{- if eq .chezmoi.os "linux" }}

# CUDA
export PATH=/usr/local/cuda/bin${PATH:+:${PATH}}
{{- end }}

# zoxide
export PATH="$HOME/.local/bin:$PATH"
eval "$(zoxide init zsh)"

{{- if eq .chezmoi.os "linux" }}

# ROS2
source /opt/ros/humble/setup.zsh

# rviz2
export QT_AUTO_SCREEN_SCALE_FACTOR=0

# Cursor AppImage
cursor() {
    nohup env all_proxy="socks5://127.0.0.1:10808" \
        ~/Cursor-x86_64.AppImage \
        >/dev/null 2>&1 &
    disown
}
{{- end }}

# 自定义脚本目录（避免重复添加）
[[ ":$PATH:" != *":$HOME/.custom_scripts:"* ]] && export PATH="$HOME/.custom_scripts:$PATH"
